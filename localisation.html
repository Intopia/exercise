<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Country-based Pricing — Static HTML</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --bg:#0b1020; --card:#151b2f; --text:#e8ebf1; --muted:#aab3c5; --accent:#7bd8d0; --focus:#ffd166; }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 2rem;
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text); background: radial-gradient(1200px 800px at 10% 0%, #12172a, #090d1a 55%), var(--bg);
    }
    .container {
      max-width: 880px; margin: 0 auto;
      display: grid; gap: 1rem;
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px; padding: 1.25rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    h1 { font-size: clamp(1.6rem, 1.3rem + 1.2vw, 2.2rem); margin: 0 0 .25rem; }
    p.lead { margin: 0 0 1rem; color: var(--muted); }
    .row { display: grid; gap: 1rem; grid-template-columns: 1fr; }
    @media (min-width: 720px) { .row { grid-template-columns: 1fr 1fr; } }

    label { display: inline-block; font-weight: 600; margin-bottom: .35rem; }
    select, button {
      appearance: none;
      background: var(--card); color: var(--text);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 10px; padding: .6rem .75rem; width: 100%;
      font: inherit;
    }
    button { width: auto; cursor: pointer; }
    .hint { color: var(--muted); font-size: .925rem; margin-top: .35rem; }

    .price {
      font-size: clamp(1.4rem, 1rem + 1.5vw, 2.2rem);
      font-weight: 800; letter-spacing: 0.2px;
      display: inline-flex; gap: .5rem; align-items: baseline;
    }
    .badge {
      display: inline-block; padding: .15rem .5rem; border-radius: 999px;
      background: rgba(123,216,208,0.15); color: var(--accent); font-size: .8rem; border: 1px solid rgba(123,216,208,0.35);
    }
    .prices-grid { display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); margin-top: .5rem; }
    .price-card { padding: 1rem; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); }
    .sr-only {
      position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
    .footer { color: var(--muted); font-size: .875rem; }
    .inline { display: inline-flex; gap: .5rem; align-items: center; flex-wrap: wrap; }
    .spacer { height: .25rem; }
    .loading-dot::after { content: "…"; animation: ellipsis 1.2s infinite; }
    @keyframes ellipsis { 0%{content:""} 33%{content:"."} 66%{content:".."} 100%{content:"..."} }
    :focus-visible { outline: 3px solid var(--focus); outline-offset: 2px; }
  </style>
</head>
<body>
  <main class="container">
    <section class="card" aria-labelledby="heading">
      <h1 id="heading">Pro Plan</h1>
      <p class="lead">Prices adapt to your country. You can change the country any time.</p>

      <div class="row" role="region" aria-labelledby="pricing-block">
        <div class="card" id="pricing-block">
          <div class="inline" aria-live="polite" aria-atomic="true">
            <div class="price">
              <span id="price-number" data-product="pro" data-base="true" aria-label="Price">$—</span>
              <span id="price-period" class="badge">per month</span>
            </div>
          </div>
          <div class="spacer"></div>
          <div class="prices-grid" aria-live="polite" aria-atomic="true">
            <div class="price-card">
              <strong>Pro</strong>
              <div id="price-pro" data-product="pro">$—</div>
              <div class="hint" id="tax-pro">Includes local taxes where applicable</div>
            </div>
            <div class="price-card">
              <strong>Team</strong>
              <div id="price-team" data-product="team">$—</div>
              <div class="hint" id="tax-team">Includes local taxes where applicable</div>
            </div>
            <div class="price-card">
              <strong>Enterprise</strong>
              <div id="price-enterprise" data-product="enterprise">$—</div>
              <div class="hint" id="tax-enterprise">Contact sales for volume pricing</div>
            </div>
          </div>
        </div>

        <div class="card">
          <form id="country-form">
            <label for="country">Country</label>
            <select id="country" name="country" autocomplete="country">
              <!-- A small, editable list. Add or remove as needed. -->
              <option value="AUTO">Auto detect</option>
              <option value="US">United States</option>
              <option value="AU">Australia</option>
              <option value="NZ">New Zealand</option>
              <option value="GB">United Kingdom</option>
              <option value="CA">Canada</option>
              <option value="IE">Ireland</option>
              <option value="DE">Germany</option>
              <option value="FR">France</option>
              <option value="NL">Netherlands</option>
              <option value="ES">Spain</option>
              <option value="IT">Italy</option>
              <option value="SG">Singapore</option>
              <option value="IN">India</option>
              <option value="JP">Japan</option>
            </select>
            <div class="hint" id="detected">
              Detecting your location<span class="loading-dot" aria-hidden="true"></span>
            </div>
            <div class="inline" style="margin-top:.75rem;">
              <button type="button" id="retry">Retry detect</button>
              <button type="button" id="clear">Use auto pricing</button>
            </div>
          </form>

          <div class="hint" style="margin-top:1rem;">
            Notes: Detection uses a lightweight IP geolocation lookup. Your choice is saved in your browser only.
          </div>
        </div>
      </div>
    </section>

    <section class="card footer">
      <p><strong>How it works:</strong> We map country codes to currency and price tiers. Detection order is stored choice, IP lookup, browser language, then a safe default. Screen readers will hear price updates because the numbers live in regions with aria-live.</p>
    </section>
  </main>

  <script>
    // ---------- Configuration ----------
    // Simple price table by country. Adjust freely.
    // You can also collapse groups to regions if you prefer.
    const PRICE_TABLE = {
      // USD markets
      US: { currency: "USD", locale: "en-US", prices: { pro: 10, team: 25, enterprise: 60 }, taxNote: "Taxes calculated at checkout" },
      SG: { currency: "USD", locale: "en-SG", prices: { pro: 10, team: 25, enterprise: 60 }, taxNote: "GST may apply" },

      // AUD
      AU: { currency: "AUD", locale: "en-AU", prices: { pro: 15, team: 35, enterprise: 85 }, taxNote: "Includes GST" },
      NZ: { currency: "NZD", locale: "en-NZ", prices: { pro: 16, team: 38, enterprise: 90 }, taxNote: "Includes GST" },

      // GBP
      GB: { currency: "GBP", locale: "en-GB", prices: { pro: 9, team: 22, enterprise: 55 }, taxNote: "Includes VAT" },
      IE: { currency: "EUR", locale: "en-IE", prices: { pro: 11, team: 26, enterprise: 62 }, taxNote: "Includes VAT" },

      // EUR
      DE: { currency: "EUR", locale: "de-DE", prices: { pro: 11, team: 26, enterprise: 62 }, taxNote: "Includes VAT" },
      FR: { currency: "EUR", locale: "fr-FR", prices: { pro: 11, team: 26, enterprise: 62 }, taxNote: "Includes VAT" },
      NL: { currency: "EUR", locale: "nl-NL", prices: { pro: 11, team: 26, enterprise: 62 }, taxNote: "Includes VAT" },
      ES: { currency: "EUR", locale: "es-ES", prices: { pro: 11, team: 26, enterprise: 62 }, taxNote: "Includes VAT" },
      IT: { currency: "EUR", locale: "it-IT", prices: { pro: 11, team: 26, enterprise: 62 }, taxNote: "Includes VAT" },

      // CAD, INR, JPY
      CA: { currency: "CAD", locale: "en-CA", prices: { pro: 13, team: 30, enterprise: 72 }, taxNote: "GST/HST may apply" },
      IN: { currency: "INR", locale: "en-IN", prices: { pro: 399, team: 999, enterprise: 2399 }, taxNote: "GST included where applicable" },
      JP: { currency: "JPY", locale: "ja-JP", prices: { pro: 1200, team: 3000, enterprise: 7200 }, taxNote: "Tax included" }
    };

    const DEFAULT_COUNTRY = "US";

    // ---------- Utilities ----------
    function formatMoney(amount, currency, locale) {
      try {
        return new Intl.NumberFormat(locale || "en-US", { style: "currency", currency }).format(amount);
      } catch {
        return `${currency} ${amount}`;
      }
    }

    function deriveCountryFromLanguage() {
      // e.g., "en-AU" -> "AU"
      const langs = navigator.languages || [navigator.language].filter(Boolean);
      for (const l of langs) {
        const parts = String(l).split("-");
        if (parts.length === 2) {
          const cc = parts[1].toUpperCase();
          if (PRICE_TABLE[cc]) return cc;
        }
      }
      return null;
    }

    function saveChoice(cc) {
      try { localStorage.setItem("countryOverride", cc); } catch {}
    }
    function readChoice() {
      try { return localStorage.getItem("countryOverride"); } catch { return null; }
    }
    function clearChoice() {
      try { localStorage.removeItem("countryOverride"); } catch {}
    }

    // ---------- Geolocation with timeout ----------
    async function detectCountryByIP({ timeoutMs = 1800 } = {}) {
      const controller = new AbortController();
      const t = setTimeout(() => controller.abort(), timeoutMs);

      // Using ipapi.co as a simple demo endpoint. Replace with your preferred service.
      try {
        const res = await fetch("https://ipapi.co/json/", { signal: controller.signal });
        clearTimeout(t);
        if (!res.ok) throw new Error("Bad response");
        const data = await res.json();
        const cc = (data && data.country_code || "").toUpperCase();
        return cc || null;
      } catch {
        clearTimeout(t);
        return null;
      }
    }

    // ---------- Rendering ----------
    function renderForCountry(cc) {
      const selected = PRICE_TABLE[cc] ? cc : DEFAULT_COUNTRY;
      const cfg = PRICE_TABLE[selected];

      // Update the select box without triggering change handler
      const select = document.getElementById("country");
      if (select && select.value !== selected) select.value = selected;

      // Update price cards
      const products = ["pro", "team", "enterprise"];
      for (const id of products) {
        const node = document.getElementById(`price-${id}`);
        if (!node) continue;
        const amount = cfg.prices[id];
        node.textContent = formatMoney(amount, cfg.currency, cfg.locale) + " / mo";
        const taxNode = document.getElementById(`tax-${id}`);
        if (taxNode && cfg.taxNote) taxNode.textContent = cfg.taxNote;
      }

      // Big headline price mirrors "pro"
      const big = document.getElementById("price-number");
      if (big) big.textContent = formatMoney(cfg.prices.pro, cfg.currency, cfg.locale);

      // Detection text
      const det = document.getElementById("detected");
      if (det) {
        det.textContent = (cc === "AUTO")
          ? `Using auto detection. Showing prices for ${displayCountryName(selected)}.`
          : `Showing prices for ${displayCountryName(selected)}.`;
      }
    }

    function displayCountryName(cc) {
      const map = {
        AUTO: "Auto",
        US: "United States", AU: "Australia", NZ: "New Zealand", GB: "United Kingdom",
        CA: "Canada", IE: "Ireland", DE: "Germany", FR: "France", NL: "Netherlands",
        ES: "Spain", IT: "Italy", SG: "Singapore", IN: "India", JP: "Japan"
      };
      return map[cc] || cc;
    }

    // ---------- Init flow ----------
    async function initPricing() {
      const select = document.getElementById("country");
      const detectedEl = document.getElementById("detected");

      // 1) If user has a stored choice, use it.
      const stored = readChoice();
      if (stored && stored !== "AUTO") {
        renderForCountry(stored);
        if (detectedEl) detectedEl.textContent = `Using your saved choice: ${displayCountryName(stored)}.`;
        return;
      }

      // 2) Try IP detection with timeout
      if (detectedEl) detectedEl.textContent = "Detecting your location…";
      const byIP = await detectCountryByIP();
      if (byIP && PRICE_TABLE[byIP]) {
        renderForCountry(byIP);
        if (detectedEl) detectedEl.textContent = `Detected by IP: ${displayCountryName(byIP)}.`;
        return;
      }

      // 3) Fall back to browser language
      const byLang = deriveCountryFromLanguage();
      if (byLang) {
        renderForCountry(byLang);
        if (detectedEl) detectedEl.textContent = `Using browser language: ${displayCountryName(byLang)}.`;
        return;
      }

      // 4) Final fallback
      renderForCountry(DEFAULT_COUNTRY);
      if (detectedEl) detectedEl.textContent = `Falling back to ${displayCountryName(DEFAULT_COUNTRY)}.`;
      if (select) select.value = DEFAULT_COUNTRY;
    }

    // ---------- Handlers ----------
    document.getElementById("country").addEventListener("change", (e) => {
      const cc = e.target.value;
      if (cc === "AUTO") {
        clearChoice();
        renderForCountry("AUTO");
        initPricing(); // re-run detection
        return;
      }
      saveChoice(cc);
      renderForCountry(cc);
    });

    document.getElementById("retry").addEventListener("click", async () => {
      const det = document.getElementById("detected");
      if (det) det.textContent = "Trying to detect again…";
      const byIP = await detectCountryByIP({ timeoutMs: 2000 });
      if (byIP && PRICE_TABLE[byIP]) {
        renderForCountry(byIP);
        saveChoice(byIP);
      } else {
        if (det) det.textContent = "Could not detect. You can choose a country from the list.";
      }
    });

    document.getElementById("clear").addEventListener("click", () => {
      clearChoice();
      document.getElementById("country").value = "AUTO";
      renderForCountry("AUTO");
      initPricing();
    });

    // Kick off
    initPricing();
  </script>
</body>
</html>
